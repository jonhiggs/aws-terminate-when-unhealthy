#!/bin/bash

function testSystemIsEc2() {
  # one of these two tests will fail.
  assertFalse "system isn't an ec2 instance" "systemIsEc2"
  assertTrue "system is an ec2 instance" "systemIsEc2"
}

function testSystemGetMeta() {

  if systemIsEc2; then
    assertTrue "should get instance-id of ec2 instance" "systemGetMeta instance-id"
    assertTrue "should have \$INSTANCE_ID set" "echo $INSTANCE_ID | egrep '^i-[0-9a-f]{8}$'"
    assertTrue "should get instance-id from variable this time." "systemGetMeta instance-id"

    assertTrue "should get ami-id of ec2 instance" "systemGetMeta ami-id"
    assertTrue "should have \$AMI_ID set" "echo $AMI_ID | egrep '^ami-[0-9a-f]{8}$'"
    assertTrue "should get ami-id from variable this time." "systemGetMeta instance-id"
  else
    assertFalse "should not get meta if not an ec2 instance" "systemGetMeta instance-id"
  fi
}

function oneTimeSetUp() {
  # load include to test
  source ../lib/system.inc
}

function SetUp() {
  unset IS_EC2
  unset INSTANCE_ID
  unset AMI_ID
}


# load and run shUnit2
source ./shunit/src/shunit2

# vim: ai ts=2 sw=2 et sts=2 ft=sh
